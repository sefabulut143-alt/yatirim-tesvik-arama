<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Yatırım Teşvik Belgesi Arama</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .search-container {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .result-card {
            transition: all 0.3s ease;
            border: 1px solid #e5e7eb;
        }
        .result-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #3b82f6;
        }
        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #f3f4f6;
        }
        .detail-row:last-child {
            border-bottom: none;
        }
        .detail-label {
            font-weight: 600;
            color: #1f2937;
            min-width: 200px;
        }
        .detail-value {
            color: #4b5563;
            text-align: right;
            flex: 1;
            margin-left: 20px;
        }
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }
        .status-active {
            background: #dcfce7;
            color: #166534;
        }
        .status-closed {
            background: #fef2f2;
            color: #dc2626;
        }
        .amount-highlight {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: bold;
        }
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .loading-content {
            background: white;
            padding: 2rem;
            border-radius: 1rem;
            text-align: center;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <i class="fas fa-spinner fa-spin text-4xl text-blue-600 mb-4"></i>
            <h3 class="text-xl font-bold text-gray-800 mb-2">Veriler Yükleniyor</h3>
            <p class="text-gray-600">105,778 adet yatırım teşvik belgesi yükleniyor...</p>
        </div>
    </div>

    <!-- Header -->
    <header class="search-container text-white py-8">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <h2 class="text-4xl font-bold mb-4">
                    <i class="fas fa-search mr-3"></i>
                    Yatırım Teşvik Belgesi Arama
                </h2>
                <p class="text-xl opacity-90">2009-2023 Yatırım Teşvik Belgeleri</p>
            </div>
            
            <!-- Search Bar -->
            <div class="max-w-2xl mx-auto mt-8">
                <div class="relative">
                    <input type="text" 
                           id="searchInput" 
                           placeholder="Firma adı, il, ilçe veya sektör arayın..." 
                           class="w-full px-6 py-4 text-lg text-gray-800 rounded-full shadow-lg focus:outline-none focus:ring-4 focus:ring-blue-300">
                    <button onclick="search()" 
                            class="absolute right-2 top-2 bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-full transition-colors">
                        <i class="fas fa-search"></i> Ara
                    </button>
                </div>
            </div>
        </div>
    </header>

    <!-- Stats -->
    <div class="container mx-auto px-4 py-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <i class="fas fa-building text-3xl text-blue-600 mb-3"></i>
                <h3 class="text-2xl font-bold text-gray-800" id="totalCompanies">105,778+</h3>
                <p class="text-gray-600">Firma</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <i class="fas fa-map-marker-alt text-3xl text-green-600 mb-3"></i>
                <h3 class="text-2xl font-bold text-gray-800" id="totalCities">82</h3>
                <p class="text-gray-600">İl</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <i class="fas fa-industry text-3xl text-purple-600 mb-3"></i>
                <h3 class="text-2xl font-bold text-gray-800" id="totalSectors">547</h3>
                <p class="text-gray-600">Sektör</p>
            </div>
            <div class="bg-white rounded-lg shadow-md p-6 text-center">
                <i class="fas fa-calendar text-3xl text-orange-600 mb-3"></i>
                <h3 class="text-2xl font-bold text-gray-800">2009-2023</h3>
                <p class="text-gray-600">Yıl Aralığı</p>
            </div>
        </div>
    </div>

    <!-- Results Count -->
    <div class="container mx-auto px-4 mb-6">
        <div id="resultsCount" class="hidden">
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <div class="flex items-center">
                    <i class="fas fa-info-circle text-blue-600 mr-3"></i>
                    <span class="text-blue-800 font-semibold" id="countText"></span>
                </div>
            </div>
        </div>
    </div>

    <!-- Results -->
    <div class="container mx-auto px-4 pb-8">
        <div id="results" class="space-y-6"></div>
        <div id="loading" class="hidden text-center py-8">
            <i class="fas fa-spinner fa-spin text-3xl text-blue-600"></i>
            <p class="mt-4 text-gray-600">Aranıyor...</p>
        </div>
        <div id="noResults" class="hidden text-center py-8">
            <i class="fas fa-search text-3xl text-gray-400"></i>
            <p class="mt-4 text-gray-600">Sonuç bulunamadı</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8">
        <div class="container mx-auto px-4 text-center">
            <p>&copy; 2024 Yatırım Teşvik Belgesi Arama. Tüm hakları saklıdır.</p>
            <p class="mt-2 text-gray-400">Mobil uyumlu • PWA desteği • 7/24 erişim</p>
        </div>
    </footer>

    <!-- Tüm firmaları yükle -->
    <script src="all_companies.js"></script>
    
    <script>
        let filteredData = [];

        // Sayfa yüklendiğinde
        window.onload = function() {
            // allData artık all_companies.js'den yükleniyor
            filteredData = allData;
            updateStats();
            displayResults(allData.slice(0, 50)); // İlk 50 kaydı göster
            document.getElementById('loadingOverlay').style.display = 'none';
        };

        // İstatistikleri güncelle
        function updateStats() {
            const uniqueCities = [...new Set(allData.map(item => item.yatirim_yeri))].length;
            const uniqueSectors = [...new Set(allData.map(item => item.yatirim_sektoru))].length;
            
            document.getElementById('totalCompanies').textContent = allData.length.toLocaleString();
            document.getElementById('totalCities').textContent = uniqueCities;
            document.getElementById('totalSectors').textContent = uniqueSectors;
        }

        function search() {
            const query = document.getElementById('searchInput').value.trim();
            
            showLoading();
            
            setTimeout(() => {
                if (!query) {
                    // Boş arama yapılırsa ilk 50 kaydı göster
                    filteredData = allData.slice(0, 50);
                } else {
                    // Arama yapılırsa filtrele
                    filteredData = allData.filter(item => 
                        (item.firma_adi && item.firma_adi.toLowerCase().includes(query.toLowerCase())) ||
                        (item.yatirim_yeri && item.yatirim_yeri.toLowerCase().includes(query.toLowerCase())) ||
                        (item.yatirim_ilce && item.yatirim_ilce.toLowerCase().includes(query.toLowerCase())) ||
                        (item.yatirim_sektoru && item.yatirim_sektoru.toLowerCase().includes(query.toLowerCase())) ||
                        (item.belge_no && item.belge_no.includes(query)) ||
                        (item.belge_turu && item.belge_turu.toLowerCase().includes(query.toLowerCase())) ||
                        (item.yatirim_cinsi && item.yatirim_cinsi.toLowerCase().includes(query.toLowerCase()))
                    );
                }
                
                displayResults(filteredData.slice(0, 100)); // Maksimum 100 sonuç göster
            }, 300);
        }

        function showLoading() {
            document.getElementById('loading').classList.remove('hidden');
            document.getElementById('results').innerHTML = '';
            document.getElementById('noResults').classList.add('hidden');
            document.getElementById('resultsCount').classList.add('hidden');
        }

        function displayResults(results) {
            document.getElementById('loading').classList.add('hidden');
            const resultsDiv = document.getElementById('results');
            const resultsCountDiv = document.getElementById('resultsCount');
            const countTextDiv = document.getElementById('countText');
            
            if (results.length === 0) {
                document.getElementById('noResults').classList.remove('hidden');
                resultsCountDiv.classList.add('hidden');
                return;
            }

            // Sonuç sayısını göster
            const totalCount = filteredData.length;
            countTextDiv.textContent = `${results.length} adet sonuç gösteriliyor (Toplam: ${totalCount} adet)`;
            resultsCountDiv.classList.remove('hidden');
            
            resultsDiv.innerHTML = results.map((item, index) => `
                <div class="result-card bg-white rounded-lg shadow-md p-6 hover:shadow-lg">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex-1">
                            <h3 class="text-xl font-bold text-gray-800 mb-2">${item.firma_adi || 'Firma adı belirtilmemiş'}</h3>
                            <div class="flex items-center space-x-4">
                                <span class="text-sm text-gray-500">Belge No: ${item.belge_no || 'Belirtilmemiş'}</span>
                                <span class="status-badge ${(item.belge_durumu === 'KAPALI') ? 'status-closed' : 'status-active'}">${item.belge_durumu || 'Belirtilmemiş'}</span>
                            </div>
                        </div>
                        <div class="flex space-x-2">
                            <button class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors">
                                GENEL
                            </button>
                            <button onclick="copyToClipboard(${index})" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition-colors">
                                <i class="fas fa-copy mr-2"></i>Kopyala
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-gray-50 to-blue-50 rounded-lg p-6">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-3">
                                <div class="detail-row">
                                    <span class="detail-label">Belge No / Türü:</span>
                                    <span class="detail-value">${item.belge_no || '-'} / ${item.belge_turu || '-'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Belge Tarihi:</span>
                                    <span class="detail-value">${item.belge_tarihi || '-'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Belge Bitiş Tarihi:</span>
                                    <span class="detail-value">${item.belge_bitis_tarihi || '-'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Yatırım Yeri:</span>
                                    <span class="detail-value">${item.yatirim_yeri || '-'} ${item.yatirim_ilce ? `(${item.yatirim_ilce})` : ''}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Yatırımın Cinsi:</span>
                                    <span class="detail-value">${item.yatirim_cinsi || '-'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Yatırımın Sektörü:</span>
                                    <span class="detail-value">${item.yatirim_sektoru || '-'}</span>
                                </div>
                            </div>
                            <div class="space-y-3">
                                <div class="detail-row">
                                    <span class="detail-label">KDV İstisnası:</span>
                                    <span class="detail-value">${item.kdv_istisnasi || '-'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Gümrük Vergisi Muafiyeti:</span>
                                    <span class="detail-value">${item.gumruk_vergisi_muafiyeti || '-'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Vergi İndirimi:</span>
                                    <span class="detail-value">${item.vergi_indirimi || '-'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Sabit Yatırım Tutarı:</span>
                                    <span class="amount-highlight">${item.sabit_yatirim_tutari || '-'}</span>
                                </div>
                                <div class="detail-row">
                                    <span class="detail-label">Belge Durumu:</span>
                                    <span class="detail-value">${item.belge_durumu || '-'}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function copyToClipboard(index) {
            const item = filteredData[index];
            const copyText = `
YATIRIM TEŞVİK BELGESİ BİLGİLERİ

Firma Adı: ${item.firma_adi || 'Belirtilmemiş'}
Belge No: ${item.belge_no || 'Belirtilmemiş'}
Belge Türü: ${item.belge_turu || 'Belirtilmemiş'}
Belge Tarihi: ${item.belge_tarihi || 'Belirtilmemiş'}
Belge Bitiş Tarihi: ${item.belge_bitis_tarihi || 'Belirtilmemiş'}
Yatırım Yeri: ${item.yatirim_yeri || 'Belirtilmemiş'} ${item.yatirim_ilce ? `(${item.yatirim_ilce})` : ''}
Yatırımın Cinsi: ${item.yatirim_cinsi || 'Belirtilmemiş'}
Yatırımın Sektörü: ${item.yatirim_sektoru || 'Belirtilmemiş'}
KDV İstisnası: ${item.kdv_istisnasi || 'Belirtilmemiş'}
Gümrük Vergisi Muafiyeti: ${item.gumruk_vergisi_muafiyeti || 'Belirtilmemiş'}
Vergi İndirimi: ${item.vergi_indirimi || 'Belirtilmemiş'}
Sabit Yatırım Tutarı: ${item.sabit_yatirim_tutari || 'Belirtilmemiş'}
Belge Durumu: ${item.belge_durumu || 'Belirtilmemiş'}
            `.trim();

            navigator.clipboard.writeText(copyText).then(() => {
                // Başarı mesajı göster
                const button = event.target.closest('button');
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check mr-2"></i>Kopyalandı!';
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-green-600');
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.classList.remove('bg-green-600');
                    button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                }, 2000);
            });
        }

        // Enter tuşu ile arama
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                search();
            }
        });
    </script>
</body>
</html>
